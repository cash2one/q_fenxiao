function appBack(){ht.address.goBack()}!function(){ht.address={init:function(){ht.core.dialog.init(),ht.core.popUp.init(),ht.core.location.init(),this.getEmptyTemp(),this.getAddressList(),this.bindEvent()},getEmptyTemp:function(){var t='<section class="m-emtpy f-tac"><a id="w-newbtn" class="u-btn u-btn-1">添加收货地址</a></section>';$.template("templateEmpty",t)},dataAddress:null,parseDataAddress:function(t){for(var e=0,s=t.length;s>e;e++)t[e].index=e,t[e].isChecked=0,t[e].addressInfo=t[e].province+t[e].city+t[e].area+t[e].address,$("#address_id")[0]&&$("#address_id").val()==t[e].id&&(t[e].isChecked=1);return t},getAddressList:function(){var t=this;$.getJSON("/member/address_list.html",function(e){200==e.state&&($("#myAddressList").empty(),t.dataAddress=e.addresses,t.dataAddress=[],0==t.dataAddress.length?$.tmpl("templateEmpty",{}).appendTo("#newbtnbox"):(t.dataAddress=t.parseDataAddress(t.dataAddress),$("#templateAddList").tmpl(t.dataAddress).appendTo("#myAddressList"),$("#address").removeClass("f-dn"),$("#toptitle").html("收货地址选择"),$("#menu").hide()))})},goBack:function(){var t=this,e=$("#toptitle"),s=e.html();switch(s){case"收货地址管理":history.back();break;case"收货地址选择":e.html("确认订单"),$("#address").addClass("f-dn"),$("#orderform").removeClass("f-dn"),t.getThisAddress();break;case"修改收货地址":e.html("收货地址选择"),$("#addressList").show(),$("#newaddressbox").empty();break;case"新建收货地址":t.dataAddress?(e.html("新建收货地址"),$("#newaddressbox").empty(),$("#addressList").show()):(e.html("收货地址管理"),$("#newaddressbox").empty().hide(),$("#address").addClass("f-dn"),$("#orderform").removeClass("f-dn"))}},bindEvent:function(){var t=this,e=$("#toptitle");$("#backbtnConf").on("click",function(){t.goBack()}),$("#g-bd").on("click","#w-newbtn",function(){$("#address").removeClass("f-dn"),$("#addressList").hide(),$("#newaddressbox").empty().show(),$("#templateAddAddress").tmpl({isEdit:0}).appendTo("#newaddressbox"),e.html("新建收货地址"),ht.core.location.getLocation(0),$(this).hide()}),$(".submitbtn").on("click",function(){return $("#oneaddress")[0]?void $("#orderSubmitForm")[0].submit():(ht.core.popUp.show("请先填写收货地址"),!1)}),$("#newbtn").on("click",function(){$("#addressList").hide(),$("#newaddressbox").empty().show(),$("#templateAddAddress").tmpl({isEdit:0}).appendTo("#newaddressbox"),e.html("新建收货地址"),ht.core.location.getLocation(0)}),$("#myAddressList").on("click",".delete",function(){var e=$(this),s=e.closest(".addritm"),d=$("#myAddressList .addritm").index(s),a=[{_aniClass:"show",confirm:{text:"确定要删除该收货地址吗？",btns:[{text:"确定",action:"ok"},{text:"取消",action:"close"}]}}];ht.core.dialog.show(a),ht.core.dialog.yes(function(){var s={_xsrf:$("input[name=_xsrf]").val(),address_id:e.closest(".addritm").attr("data-id")};$.ajax({url:"/member/address.html",data:s,type:"DELETE",success:function(s){s=JSON.parse(s),200==s.state&&(e.closest(".addritm").remove(),t.dataAddress.splice(d,1),ht.core.dialog.hide())}})})}).on("click",".edit",function(){var s=$(this),d=s.closest(".addritm"),a=$("#myAddressList .addritm").index(d);$("#addressList").hide(),$("#newaddressbox").empty().show();var r=t.dataAddress[a];r.isEdit=1,$("#templateAddAddress").tmpl(r).appendTo("#newaddressbox"),ht.core.location.getLocation(1,function(){var t=$("#province .option[title="+r.province+"]");t.attr("selected","selected");var e=t.attr("value"),s={parent_id:e,query_type:"city"};ht.core.location.get(s,"zp-city",0,$("#city"),1,function(){var t=$("#city .option[title="+r.city+"]");t.attr("selected","selected");var e=t.attr("value"),s={parent_id:e,query_type:"area"};ht.core.location.get(s,"zp-area",0,$("#area"),1,function(){var t=$("#area .option[title="+r.area+"]");t.attr("selected","selected")})})}),e.html("修改收货地址")}),$("#g-bd").on("click","#onlyAddress",function(){t.getAddressList()}),$("body").on("click","#m-savebtn",function(){var s=$("#name"),d=$("#idNum"),a=$("#mobile"),r=$("#province"),i=$("#city"),o=$("#area"),n=$("#yourAddress");if(""==$.trim($("#name").val()))return void ht.core.popUp.show(s.attr("data-message"));if(!ht.core.regular.phone.test(a.val()))return void ht.core.popUp.show(a.attr("data-message"));if(!ht.core.regular.idcard(d.val()))return void ht.core.popUp.show(d.attr("data-message"));if("-1"==r.val())return void ht.core.popUp.show(r.attr("data-message"));if("-1"==i.val())return void ht.core.popUp.show(i.attr("data-message"));if("-1"==o.val())return void ht.core.popUp.show(o.attr("data-message"));if(n.val().length<5)return void ht.core.popUp.show(n.attr("data-message"));var c={_xsrf:$("input[name=_xsrf]").val(),name:s.val(),province:r.val(),city:i.val(),area:o.val(),address:n.val(),card_num:d.val(),phone:a.val()};1==$(this).attr("data-isEdit")&&(c.address_id=$(this).attr("data-id"));c.address_id;$.post("/member/address.html",c,function(s){var s=JSON.parse(s);200==s.state&&(e.html("收货地址选择"),t.getAddressList(),$("#newaddressbox").empty(),$("#addressList").show())})})}},$(function(){ht.address.init()})}();