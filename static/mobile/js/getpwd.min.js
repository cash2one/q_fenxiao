!function(){ht.getpwd={init:function(){this.bindEvent()},popUp:function(t){var e=$("#popUp");e.find(".box").html(t),e.show(),setTimeout(function(){$("#popUp").hide()},1e3)},setCountDown:function(t,e){var n=parseInt(t.attr("v"),10),a=n-1;if(a>0){t.html("重新获取("+a+")").attr("v",a).addClass("btn_enabled");var o=setTimeout(function(){ht.login.setCountDown(t,e)},1e3)}else clearTimeout(o),t.html(e).removeClass("btn_enabled")},validate:{data:{phone:!1,kapkey:!1},chkPhone:function(){var t=ht.getpwd,e=!1,n=$("#phone");return""==n.val()?t.popUp("请输入手机号码"):/^1\d{10}$/.test(n.val())?e=!0:t.popUp("手机号码格式不正确"),this.data.phone=e,e},chkKapkey:function(){var t=ht.getpwd,e=!1,n=$("#kapkey");return 0==this.data.phone?!1:(""==n.val()?t.popUp("请输入验证码"):5!=n.val().length?t.popUp("验证码错误"):e=!0,this.data.kapkey=e,e)},chkSmsCode:function(){var t=ht.getpwd,e=!1,n=$("#smskey");return""==n.val()?t.popUp("请输入短信验证码"):4!=n.val().length?t.popUp("短信验证码错误"):e=!0,e},chkPassword:function(t){var e=ht.getpwd,n=!1;return t.val().length<6||t.val().length>18?e.popUp("请输入6-18位字符"):n=!0,n}},bindEvent:function(){var t=this;$("#imgKey").click(function(){$(this)[0].src="/common/image_code/?"+Math.random()});var e=$("#phone"),n=$("#namedel"),a=$("#kapkey");e.on("keyup",function(){""!=$(this).val()&&n.show()}),n.on("click",function(){e.val(""),$(this).hide()});var a=$("#kapkey");$("#getPwdSubmit").on("click",function(){var n=t.validate.chkPhone(),o=t.validate.chkKapkey();if(n&&o){var p=$("input[name=_xsrf]").val(),i={phone:e.val(),code:a.val(),_xsrf:p};$.post("/reg.html",i,function(e){var e=JSON.parse(e);if(200!=e.state)return t.popUp(e.info),!1;$("#step2_txt").html(e.info),$(".step1").hide(),$(".step2").show();var n=60;$("#getKey").html("重新获取("+n+")").attr("v",n).addClass("btn_enabled"),ht.core.setCountDown($("#getKey"),"获取验证码")})}}),$("#next").click(function(){var n=t.validate.chkSmsCode();if(n){var a={phone:e.val(),phonecode:$("#smskey").val()};$.get("/reg.html",a,function(e){var e=JSON.parse(e);return 200!=e.state?(t.popUp(e.info),!1):($(".step2").hide(),void $(".step3").show())})}}),$("#getKey").click(function(){if($(this).hasClass("btn_enabled"))return!1;var t={phone:e.val()};$.get("/common/phone/code/",t,function(){var t=60;$("#getKey").html("重新获取("+t+")").attr("v",t).addClass("btn_enabled"),ht.core.setCountDown($("#getKey"),"获取验证码")})}),$("#regSubmit").click(function(){var n=t.validate.chkPassword($("#password1")),a=t.validate.chkPassword($("#password2"));if(n&&a)if($("#password1").val()!=$("#password2").val())t.popUp("两次密码输入不一致");else{var o=$("input[name=_xsrf]").val(),p={phone:e.val(),pwd:$("#password1").val(),smskey:$("#smskey").val(),option:"reg",_xsrf:o};$.post("/reg.html",p,function(e){var e=JSON.parse(e);return 200!=e.state?(t.popUp(e.info),!1):void(window.location="/")})}})}}}(),$(function(){ht.getpwd.init()});