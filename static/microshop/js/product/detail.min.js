!function(t){t.fly=function(a,i){var s={version:"1.0.0",autoPlay:!0,vertex_Rtop:20,speed:1.2,start:{},end:{},onEnd:t.noop},o=this,e=t(a);o.init=function(t){this.setOptions(t),!!this.settings.autoPlay&&this.play()},o.setOptions=function(a){this.settings=t.extend(!0,{},s,a);var i=this.settings,o=i.start,n=i.end;e.css({marginTop:"0px",marginLeft:"0px",position:"absolute"}).appendTo("body"),null!=n.width&&null!=n.height&&t.extend(!0,o,{width:e.width(),height:e.height()});var d=Math.min(o.top,n.top)-Math.abs(o.left-n.left)/3;d<i.vertex_Rtop&&(d=Math.min(i.vertex_Rtop,Math.min(o.top,n.top)));var l=Math.sqrt(Math.pow(o.top-n.top,2)+Math.pow(o.left-n.left,2)),h=Math.ceil(Math.min(Math.max(Math.log(l)/.05-75,30),100)/i.speed),r=o.top==d?0:-Math.sqrt((n.top-d)/(o.top-d)),m=(r*o.left-n.left)/(r-1),u=n.left==m?0:(n.top-d)/Math.pow(n.left-m,2);t.extend(!0,i,{count:-1,steps:h,vertex_left:m,vertex_top:d,curvature:u})},o.play=function(){this.move()},o.move=function(){var a=this.settings,i=a.start,s=a.count,o=a.steps,n=a.end,d=i.left+(n.left-i.left)*s/o,l=0==a.curvature?i.top+(n.top-i.top)*s/o:a.curvature*Math.pow(d-a.vertex_left,2)+a.vertex_top;if(null!=n.width&&null!=n.height){var h=o/2,r=n.width-(n.width-i.width)*Math.cos(h>s?0:(s-h)/(o-h)*Math.PI/2),m=n.height-(n.height-i.height)*Math.cos(h>s?0:(s-h)/(o-h)*Math.PI/2);e.css({width:r+"px",height:m+"px","font-size":Math.min(r,m)+"px"})}e.css({left:d+"px",top:l+"px"}),a.count++;var u=window.requestAnimationFrame(t.proxy(this.move,this));s==o&&(window.cancelAnimationFrame(u),a.onEnd.apply(this))},o.destory=function(){e.remove()},o.init(i)},t.fn.fly=function(a){return this.each(function(){void 0==t(this).data("fly")&&t(this).data("fly",new t.fly(this,a))})}}(jQuery),ht.detail={init:function(){this.loadData(),this.getTax(),this.bindEvent()},getTax:function(){var t="True"==ht.detail.goodInfo.is_abroad?0:1,a=ht.core.ops.tax[t];this.maxPrice=a.maxPrice,this.taxRate=a.taxRate,this.payTax=a.payTax},tempBuyAmount:0,loadData:function(){ht.detail.goodInfo=window.__getGoodsInfo();var t=__getGoodsDetail(),a="http://cdn.qqqg.com/web/images/blank.gif",i=/(<img [^>]*src=['"])([^'"]+[^>]*>)/gi,s="全球抢购";t=t.replace(i,"$1"+a+'" class="j-lazy"data-width="@640w" alt="'+s+'"  data-src="$2'),$("#js_goodsdetail").html(t);var o={lowStocks:ht.detail.goodInfo.lowStocks,cartCount:ht.detail.goodInfo.cart_count>99?"99+":ht.detail.goodInfo.cart_count};$("#templateBtns").tmpl(o).appendTo("#m-buybar");var e={main_pic:ht.detail.goodInfo.main_pic,title:ht.detail.goodInfo.title,price:ht.detail.goodInfo.price,stockTxt:"True"==this.goodInfo.lowStocks?"库存不足":"库存充足",stockTip:parseInt(ht.detail.goodInfo.min_limit_quantity,10)>1?"最少限购数量"+ht.detail.goodInfo.min_limit_quantity:"",tempBuyAmount:this.tempBuyAmount>this.goodInfo.min_limit_quantity?this.goodInfo.tempBuyAmount:this.goodInfo.min_limit_quantity};$("#templateSku").tmpl(e).appendTo("#m-sku")},bindEvent:function(){_this=this;var t=$("#m-buybar");t.on("click","#buyNow",function(t){if(!$(this).hasClass("dis")){var i=a.val();if(i=parseInt(i,10),"确认购买"==$(this).html())return $("#buyNowFm .fmItem_id").val(ht.detail.goodInfo.itemId),$("#buyNowFm .fmItem_tempBuyAmount").val(i),void $("#buyNowFm")[0].submit();$(".m-sku-mask").addClass("show"),$(".m-sku").addClass("show"),$(this).addClass("show").addClass("btn-large").html("确认购买"),$("#addCart").addClass("hide")}}).on("click","#addCart",function(t){if(!$(this).hasClass("dis")){if("确认加入"==$(this).html())return $("#popUp").show(),_this.flyToCart($(this),t),void setTimeout(function(){},1e3);$(".m-sku-mask").addClass("show"),$(".m-sku").addClass("show"),$("#buyNow").addClass("hide"),$(this).html("确认加入").addClass("show").addClass("btn-large"),$("#cart").removeClass("hide")}}),$("#m-sku").on("click","#topbar-back",function(){$(".m-sku-mask").removeClass("show"),$(".m-sku").removeClass("show"),$("#addCart").removeClass("hide").html("加入购物车").removeClass("flyNow"),$("#buyNow").removeClass("btn-large").removeClass("hide").html("立即购买").removeClass("dis"),$("#cart").removeClass("hide")});var a=$("#tempBuyAmountObj"),i=$(".minus"),s=$(".plus");a.on("keyup",function(){var t=parseInt(ht.detail.goodInfo.max_limit_quantity,10),a=parseInt(ht.detail.goodInfo.min_limit_quantity,10),o=parseInt(ht.detail.goodInfo.sale_quantity,10)-parseInt(ht.detail.goodInfo.warning_quantity,10);o=o>1?o-1:o;var e=o>=t?t:o;if(1==$(this).val().length){var n=$(this).val().replace(/[^1-9]/g,"");n=parseInt(n,10);var d=""==n||a>n?a:n;d=n>e?e:d,$(this).val(d)}else{var n=$(this).val().replace(/\D/g,"");n=parseInt(n,10);var d=""==n||a>n?a:n;d=n>e?e:d,$(this).val(d)}1!=$(this).attr("isNone")&&($(this).val()>a?i.removeClass("dis").children().removeClass("u-icn14-3"):i.addClass("dis").children().addClass("u-icn14-3"),$(this).val()>=e?s.addClass("dis").children().addClass("u-icn14-2"):s.removeClass("dis").children().removeClass("u-icn14-2"))}),s.on("click",function(){var t=$("#overAmount"),s=a.val(),o=parseInt(ht.detail.goodInfo.sale_quantity,10)-parseInt(ht.detail.goodInfo.warning_quantity,10);return o=o>1?o-1:o,s==o?($(this).addClass("dis"),$(this).children().addClass("u-icn14-2"),void t.addClass("show").find(".desc").html("啊哦，已经达到最大购买数。")):s==ht.detail.goodInfo.max_limit_quantity?($(this).addClass("dis"),$(this).children().addClass("u-icn14-2"),void t.addClass("show").find(".desc").html("啊哦，已经达到最大购买数。")):(s=parseInt(s,10)+1,s>1?i.removeClass("dis").children().removeClass("u-icn14-3"):i.addClass("dis").children().addClass("u-icn14-3"),void a.val(s))}),i.on("click",function(){var t=$("#overAmount");if($(this).hasClass("dis"))return!1;var o=a.val();return o==ht.detail.goodInfo.min_limit_quantity?($(this).addClass("dis"),!1):(o=parseInt(o,10)-1,t.removeClass("show"),1==o?i.addClass("dis").children().addClass("u-icn14-3"):i.removeClass("dis").children().removeClass("u-icn14-3"),s.removeClass("dis"),s.children().removeClass("u-icn14-2"),void a.val(o))}),$("#u-slide-detail").on("click",function(){var t=$("#js_goodsdetail").offset().top;$("body,html").animate({scrollTop:t},1e3)})},flyToCart:function(t,a){if($(this).hasClass("dis"))return!1;var i=$("#cart").offset(),s=$("#showImg").attr("src"),o=$('<img class="u-flyer" src="'+s+'">');o.fly({start:{left:$("#showImg").offset().left,top:$("#showImg").offset().top},end:{left:i.left+10,top:i.top+10,width:0,height:0},onEnd:function(){var t={item_id:ht.detail.goodInfo.itemId,item_num:$("#tempBuyAmountObj").val()};$.getJSON("/member/addcart",t,function(t){if(200==t.state){var a=t.account;a=a>99?"99+":a,$("#cart .count").text(a)}$("#popUp").hide(),$("#topbar-back").click()}),this.destory()}})},getPrice:function(t){}},$(function(){ht.detail.init()});