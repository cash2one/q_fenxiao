!function(e,r){ht.getpwd={init:function(){ht.util.placeholder(),this.bindEvent()},validate:{chkPhone:function(){var e=!1,r=$("#phone");return""==r.val()?(r.parent().next(".error").html("请输入手机号码"),r.parent().removeClass("err_label").addClass("err_label")):/^1\d{10}$/.test(r.val())?(r.parent().next(".error").html(""),r.parent().removeClass("err_label"),e=!0):(r.parent().next(".error").html("手机号码格式不正确"),r.parent().removeClass("err_label").addClass("err_label")),e},chkKapkey:function(){var e=!1,r=$("#kapkey");return""==r.val()?(r.parent().parent().next(".error").html("请输入验证码"),r.parent().removeClass("err_label").addClass("err_label")):5!=r.val().length?(r.parent().parent().next(".error").html("验证码错误"),r.parent().removeClass("err_label").addClass("err_label")):(r.parent().parent().next(".error").html(""),r.parent().removeClass("err_label"),e=!0),e},chkSmsCode:function(){var e=!1,r=$("#smskey");return""==r.val()?(r.parent().parent().next(".error").html("请输入短信验证码"),r.parent().removeClass("err_label").addClass("err_label")):4!=r.val().length?(r.parent().parent().next(".error").html("短信验证码错误"),r.parent().removeClass("err_label").addClass("err_label")):(r.parent().parent().next(".error").html(""),r.parent().removeClass("err_label"),e=!0),e},chkPassword:function(e){var r=!1;return e.val().length<6||e.val().length>18?(e.parent().next(".error").html("请输入6-18位字符"),e.parent().removeClass("err_label").addClass("err_label")):(e.parent().next(".error").html(""),e.parent().removeClass("err_label"),r=!0),r}},bindEvent:function(){var r=this;$("#imgKey").click(function(){$(this)[0].src="/common/image_code/?"+Math.random()});var a=$("#phone"),t=$("#kapkey"),n=$("#smskey");a.focus(function(){}).blur(function(){r.validate.chkPhone()}),t.focus(function(){}).blur(function(){r.validate.chkKapkey()}).keyup(function(e){13==e.keyCode&&$("#step1").click()}),n.blur(function(){r.validate.chkSmsCode()}).keyup(function(e){13==e.keyCode&&$("#next").click()}),$("#step1").click(function(){$("#spanerr").html("");var e=r.validate.chkPhone(),n=r.validate.chkKapkey();if(e&&n){var l=$("input[name=_xsrf]").val(),s={phone:a.val(),code:t.val(),_xsrf:l};$.post("/reg.html",s,function(e){var e=JSON.parse(e);if(200!=e.state)return $("#spanerr").html(e.info),!1;$("#step2_txt").html(e.info),$(".step1").hide(),$(".step2").show();var r=60;$("#getKey").html("重新获取("+r+")").attr("v",r).addClass("btn_enabled"),ht.util.setCountDown($("#getKey"),"获取验证码")})}}),$("#step2").click(function(){var e=r.validate.chkSmsCode();if(e){var t={phone:a.val(),phonecode:$("#smskey").val()};$.get("/reg.html",t,function(e){var e=JSON.parse(e);return 200!=e.state?($("#spansmskeyerr").html(e.info),!1):($(".step2").hide(),void $(".step3").show())})}}),$("#getKey").click(function(){if($(this).hasClass("btn_enabled"))return!1;var e={phone:a.val()};$.get("/common/phone/code/",e,function(){var e=60;$("#getKey").html("重新获取("+e+")").attr("v",e).addClass("btn_enabled"),ht.util.setCountDown($("#getKey"),"获取验证码")})}),$("#password1").blur(function(){r.validate.chkPassword($(this))}),$("#password2").blur(function(){r.validate.chkPassword($(this))}).keyup(function(e){13==e.keyCode&&$("#regSubmit").click()}),$("#getSubmit").click(function(){var t=r.validate.chkPassword($("#password1")),n=r.validate.chkPassword($("#password2"));if(t&&n)if($("#password1").val()!=$("#password2").val())$("#password2").parent().next(".error").html("两次密码输入不一致"),$("#password2").parent().removeClass("err_label").addClass("err_label");else{var l=$("input[name=_xsrf]").val(),s={phone:a.val(),pwd:$("#password1").val(),smskey:$("#smskey").val(),option:"reg",_xsrf:l};$.post("/reg.html",s,function(r){var r=JSON.parse(r);return 200!=r.state?($("#pwderr").html(r.info),!1):void(e.location="/")})}})}},$(function(){ht.getpwd.init()})}(window);