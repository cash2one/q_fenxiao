!function(t){var i={largewidth:800,largeheight:800},a=function(a){a=t.extend({},i,a);var e=t(this),s=t(this).find("b"),n=t("#showImgBig"),o=t("#showDetails"),r={width:400,height:400},c={width:800,height:800},l=t("#showImgBox").offset(),d={x:100,y:100},m={width:r.width-200,height:r.height-200},h=function(){s.show(),o.show()},u=function(){s.hide(),o.hide()},p={x:r.width/c.width,y:r.height/c.height};e.mousemove(function(t){var i=t.pageX-l.left,a=t.pageY-l.top;i-=d.x,a-=d.y,0>i&&(i=0),0>a&&(a=0),i>m.width&&(i=m.width),a>m.height&&(a=m.height),s.css({left:i,top:a}),n.css({left:0-i/p.x,top:0-a/p.y})}).mouseenter(h).mouseleave(u)};t.fn.extend({enlarge:a})}(jQuery),ht.product={init:function(){this.showPhoto.init(),this.navFix.init(),this.similar.init(),this.hisGoods.init(),ht.util.shopcartFix.init(),this.commt.init(),this.bindEvent(),$("#pageNavWrap").on("keyup",".jumptoTxt",function(){var t=$(this);1==t.val().length?t.val($(this).val().replace(/[^1-9]/g,"")):t.val($(this).val().replace(/\D/g,""))}),this.cartBar.init()},countBackwards:function(){function t(t){return 10>t?"0"+t:t}function i(){var i=new Date("2015/12/15,8:18:00"),e=new Date,n=parseInt((i.getTime()-e.getTime())/1e3);d=parseInt(n/3600/24),h=parseInt(n/3600%24),m=parseInt(n/60%60),s=parseInt(n%60);var o=$("#countBackwards");0>=n?(o.html("团购已结束"),$("#m_temaiDom").remove(),clearInterval(a)):o.html('距结束：<span class="num day">'+t(d)+'</span>天<span class="num hour">'+t(h)+'</span>时<span class="num min">'+t(m)+'</span>分<span class="num sec">'+t(s)+'</span>秒<span class="num milsec"></span>')}if($("#countBackwards")[0]){i();var a;a=setInterval(i,1e3)}},navFix:{init:function(){ht.util.sticky($("#P_nav"),function(){$("#P_nav").addClass("P_navFix")},function(){$("#P_nav").removeClass("P_navFix")})}},isHasLoad:0,bindEvent:function(){var t=$(".goodsDetailWrap").offset().top;$("#goodsDetail_T").click(function(){$(this).addClass("active").siblings().removeClass("active"),$("#goodsDetail").show(),$(window).scrollTop(t)}),$("#userRating_T").click(function(){ht.product.isHasLoad=1,$(this).addClass("active").siblings().removeClass("active"),$("#goodsDetail").hide(),$(window).scrollTop(t)}),$("#scrollTop2").click(function(){$(window).scrollTop(0)}),$("#js_skuBox").on("click",".m-favbtn",function(){var t=$(this);return $(this).hasClass("got")?!1:void $.getJSON("/checklogin.html",function(i){if(200==i.state)if(1==i.is_login){var a={_xsrf:$("input[name=_xsrf]").val(),item_id:$("#item_id").val()};$.post("/member/collections.html",a,function(i){i=JSON.parse(i),200==i.state&&t.html('<i class="iconfont ic"></i><span class="txt">已收藏</span>').addClass("got")})}else $("#js_skuBox").attr("needCollect","1"),$(".login").click()})})},commt:{init:function(){this.showMyPhoto(),this.getFirstCmt(),this.bindEvent()},pageSize:20,level:"",bindEvent:function(){$("#userRating").on("click",".wrapnRadio",function(){var t=$(this),i=t.find("input[name=commentSelect]").val();ht.product.commt.level=i;var a=parseInt(t.attr("data-count"),10),e=ht.product.commt.pageSize;$("#pageBox").pagination(a,{current_page:0,num_edge_entries:2,num_display_entries:4,prev_text:"上一页",next_text:"下一页",callback:ht.product.commt.pageselectCallback,items_per_page:e})})},pageselectCallback:function(t,i){var a=ht.product.commt.level;!a&&(a=""),ht.product.commt.getCmt(t,a)},getFirstCmt:function(){var t=parseInt($("#commentCounts").attr("data-comments"),10),i=ht.product.commt.pageSize;$("#pageBox").pagination(t,{current_page:0,num_edge_entries:2,num_display_entries:4,prev_text:"上一页",next_text:"下一页",callback:ht.product.commt.pageselectCallback,items_per_page:i})},getCmt:function(t,i){var t=t+1,a={item_id:$("#item_id").val(),assess_level:i,page:t};$.get("/item/comment_list.html",a,function(t){var a=JSON.parse(t);a.good_percent=100*a.good_percent,a.data=a.data.result,a.dataCmtItems=a.data,a.level=i;for(var e=QTIMES.date.date_to_str("%Y-%m-%d"),s=0,n=a.data.length;n>s;s++){if(a.data[s].dataCmtPics=[],""!=a.data[s].show_imgs){for(var o=[],r=a.data[s].show_imgs.split(";"),c=0,l=r.length;l>c;c++)o.push({cmtPhoto:r[c],cmtPhotoBig:r[c]});a.data[s].dataCmtPics=o}if(a.data[s].dataCmtPicsAgain=[],""!=a.data[s].add_show_imgs){for(var o=[],r=a.data[s].add_show_imgs.split(";"),c=0,d=r.length;d>c;c++)o.push({cmtPhoto:r[c],cmtPhotoBig:r[c]});a.data[s].dataCmtPicsAgain=o}a.data[s].cmtTime=new Date(1e3*a.data[s].gmt_modified),a.data[s].cmtTime=e(a.data[s].cmtTime)}$("#qscmt").empty(),$("#templateCmts").tmpl(a).appendTo("#qscmt"),1==ht.product.isHasLoad&&$("#userRating_T").click()})},showMyPhoto:function(){var t="";t+='<div style="width: 560px; overflow: hidden; position: relative; display: none;" class="preview_box preview_style">',t+=' <div style="height:350px;width:560px;padding-top:60px;overflow:hidden;text-align: center;">',t+='  <img src="/static/images/blank.gif/" />',t+=" </div>",t+='  <a name="js_colse" title="关闭" class="preview_close" href="javascript:;"></a>',t+="</div>",$("#userRating").on("click",".pic_item",function(){0==$(this).parent().next(".preview_box").size()&&$(this).parent().after(t),$(this).parent().next(".preview_box").show(),$(this).parent().next(".preview_box").find("img").attr("src",$(this).find("img")[0].src)}),$("#userRating").on("click",".preview_close",function(){$(this).parent().hide()})}},showPhoto:{init:function(){$("#overAmount").mouseover(function(){$(".tip-wrap").show()}),$(".tip-wrap").mouseout(function(){$(this).hide()}),$("#showImgBox").enlarge(),$("#litimgUl li").click(function(){$(this).addClass("active").siblings().removeClass("active");var t=$(this).find("img"),i={mid:t.attr("source"),large:t.attr("lsource")};$("#showImg").attr("src",i.mid),$("#showImgBig").attr("src",i.large),$("#showLocalImg").attr("href",i.large)})}},cartBar:{init:function(){this.addToCart(),this.bindEvent(),this.buy()},ops:{maxPrice:1e3},limitedByTariff:function(t){"False"!=$("#is_abroad").val()&&(t>ht.util.ops.tax[0].maxPrice?($("#js_overAmountTip").removeClass("hide"),$("#buyBtn,.buynowonly,#addCart").addClass("disabled")):($("#js_overAmountTip").addClass("hide"),$("#buyBtn,.buynowonly,#addCart").removeClass("disabled")))},buy:function(){$("#buyBtn,.buynowonly").click(function(){return $(this).hasClass("disabled")?!1:($("#item-order-form")[0].submit(),!1)})},bindEvent:function(){var t=$("#goodsAmount"),i=parseInt(t.attr("min_count"),10),a=parseInt(t.attr("max_Count"),10),e=$("#goodsPrice").val(),s=$("#j_buyboxnum .ctrnum-b-ad"),n=$("#j_buyboxnum .ctrnum-b-rd");s.click(function(){if(!($(this).hasClass("ctrnum-b-dis")||t.val()>=a)){var s=parseInt(t.val(),10)+1;t.val(s),t.val()>i&&n.removeClass("ctrnum-b-dis"),t.val()==a&&$(this).addClass("ctrnum-b-dis");var o=s*e;ht.product.cartBar.limitedByTariff(o)}}),n.click(function(){if(!$(this).hasClass("ctrnum-b-dis")&&!(t.val()<=i||$(this).hasClass("ctrnum-b-dis"))){var n=parseInt(t.val(),10)-1;t.val(n),t.val()==i&&$(this).addClass("ctrnum-b-dis"),t.val()<=a&&s.removeClass("ctrnum-b-dis");var o=n*e;ht.product.cartBar.limitedByTariff(o)}}),$("#goodsAmount").keyup(function(){if(1==$(this).val().length){var o=$(this).val().replace(/[^1-9]/g,""),r=""==o||i>o?i:o;r=o>a?a:r,$(this).val(r)}else{var o=$(this).val().replace(/\D/g,""),r=""==o||i>o?i:o;r=o>a?a:r,$(this).val(r)}if(1!=$(this).attr("isNone")){t.val()>i?n.removeClass("ctrnum-b-dis"):n.addClass("ctrnum-b-dis"),t.val()>=a?s.addClass("ctrnum-b-dis"):s.removeClass("ctrnum-b-dis");var c=r*e;ht.product.cartBar.limitedByTariff(c)}})},addToCart:function(){$("#addCart").click(function(t){if($(this).hasClass("disabled"))return!1;var i=($(this),$(".shopcart").offset()),a=$("#showImg").attr("src"),e=$('<img class="u-flyer" src="'+a+'">');e.fly({start:{left:$(this).offset().left,top:$(this).offset().top},end:{left:i.left+10,top:i.top+10,width:0,height:0},onEnd:function(){var t={item_id:$("#item_id").val(),item_num:$("#goodsAmount").val()};$.get("/order/cart.html",t,function(t){if(t=JSON.parse(t),200==t.state){var i=parseInt($("#rightBar2 .num").text(),10)+parseInt($("#goodsAmount").val(),10);i=i>99?"99+":i,$("#rightBar2 .num,#newcartnum").text(i)}}),this.destory()}})})}},similar:{init:function(){this.get()},get:function(){var t={category_id:$("#category_id").val()};$("#pro_seeAga,#pro_actBuy").empty(),$.getJSON("/item/similar.html",t,function(t){$("#templateSeeGoodsList").tmpl(t.viewitems).appendTo("#pro_seeAga"),$("#pro_seeAga li:last").addClass("bbNone"),$("#templateSeeGoodsList").tmpl(t.buyitems).appendTo("#pro_actBuy"),$("#pro_actBuy li:last").addClass("bbNone")})}},hisGoods:{init:function(){ht.util.lazyGet($("#pro_recBow"),function(){ht.product.hisGoods.get()})},get:function(){$("#pro_recBow").empty(),$.getJSON("/item/history.html",function(t){$("#templateHisGoodsList").tmpl(t).appendTo("#pro_recBow")})}}},$(function(){ht.product.init()});