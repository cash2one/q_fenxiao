!function(t,e){ht.member={init:function(){ht.util.shopcartFix.init(),this.modAddress.init(),this.modOrder.init(),this.modCollect.init()},modAddress:{init:function(){return $("#modAddress")[0]?(ht.util.location.init(),this.showNullAdd(),this.validAddress(),void this.bindEvent()):!1},showNullAdd:function(){0==$(".oAddress tbody tr").length&&$("#addressedit").show()},setProCityArea:function(){var t=$("#provicecityarea .result");$("#province").val(t.eq(0).attr("value")).attr("data-title",t.eq(0).html()),$("#city").val(t.eq(1).attr("value")).attr("data-title",t.eq(1).html()),$("#area").val(t.eq(2).attr("value")).attr("data-title",t.eq(2).html())},validAddress:function(){var t=this,e=$("#card_num");e.blur(function(){""==$(this).val()&&e.next(".Validform_checktip").html("").removeClass("Validform_wrong")}),$("#addressform").Validform({btnSubmit:"#addressSubmit",btnReset:"",tiptype:3,ignoreHidden:!1,ajaxPost:!0,datatype:ht.util.validformParam.datatype,beforeCheck:function(t){},beforeSubmit:function(a){if(t.setProCityArea(),""!=e.val()){if(1!=ht.util.validformParam.datatype.idcard(e.val()))return e.next(".Validform_checktip").html(e.attr("errormsg")).addClass("Validform_wrong"),!1}else e.next(".Validform_checktip").html("").removeClass("Validform_wrong")},ajaxpost:{error:function(t,e){}},callback:function(t){if("y"!=t.status)return $.Showmsg(t.info),!1;$.Hidemsg();var e=$("#province").attr("data-title")+$("#city").attr("data-title")+$("#area").attr("data-title")+$("#address").val(),a=[{name:$("#name").val(),addressdetail:e,phone:$("#phone").val(),addressid:t.addressId}];if($("#address_id")[0]){var r=$("#address_id").val(),i=$("#modAddress .oAddress tbody tr[data-id="+r+"]");i.after($("#templateoAddress").tmpl(a)),i.remove()}else $("#modAddress .oAddress tbody").append($("#templateoAddress").tmpl(a));$(".Validform_checktip").removeClass().addClass("Validform_checktip"),$("#addressform")[0].reset(),$("#addressedit").hide(),$("html,body").animate({scrollTop:0},500)}})},bindEvent:function(){var t=this;$("#m-idcardtip").hover(function(){$(this).next(".m-notice-idcard").show()},function(){$(this).next(".m-notice-idcard").hide()}),$("#linkAddAddress").click(function(){$(".zp-province .result").html("--省/直辖市--").attr("value",""),$(".zp-province .curr").removeClass("curr"),$(".zp-city,.zp-district").remove(),$("#address_id").remove(),$("#addressform")[0].reset(),$("#lblAddAddress").html("新增收货地址").show(),$("#newAddress,#addressedit").show()}),$("#newAddress .closeIcon").click(function(){$("#newAddress,#lblAddAddress").hide()}),$("#modAddress").on("click",".addDel",function(){var t=$(this);ht.util.popAlert.run(function(){var e=ht.util.popAlert.confirm("您确定要删除吗？","iDialogDelAddress");$.blockUI.defaults.css.textAlign="justify",$.blockUI({css:{width:"520px"},message:e}),$("#iDialogDelAddress .iDialogYes").click(function(){var e={_xsrf:$("input[name=_xsrf]").val(),address_id:t.closest("tr").attr("data-id")};$.ajax({url:"/member/address.html",data:e,type:"DELETE",success:function(e){e=JSON.parse(e),200==e.state&&(t.closest("tr").remove(),$("#addressform")[0].reset(),ht.member.modAddress.showNullAdd())}}),$.unblockUI()})})}),$("#modAddress").on("click",".addUpdate",function(){var e=$(this),a={operation:"query",address_id:e.closest("tr").attr("data-id")},r=a.address_id;$.getJSON("/member/address.html",a,function(e){$("#address_id")[0]?$("#address_id").val(r):$("#addressform").append('<input type="hidden" id="address_id" name="address_id" value="'+r+'" />'),$("#name").val(e.user_name),$("#address").val(e.address),$("#card_num").val(e.card_num),$("#phone").val(e.phone);var a=$(".zp-province .option[title="+e.province+"]"),i=a.attr("value");$(".zp-province .result").html(e.province).attr("value",i),a.addClass("curr");var s={parent_id:i,query_type:"city"};$(".zp-city,.zp-district").remove(),ht.util.location.get(s,ht.util.location.locationClass[1],1,function(){var a=$(".zp-city .option[title="+e.city+"]"),r=a.attr("value");$(".zp-city .result").html(e.city).attr("value",r),a.addClass("curr");var i={parent_id:r,query_type:"area"};ht.util.location.get(i,ht.util.location.locationClass[2],2,function(){var a=$(".zp-district .option[title="+e.area+"]"),r=a.attr("value");$(".zp-district .result").html(e.area).attr("value",r),a.addClass("curr"),$("#myLocation").val("1"),t.setProCityArea()})}),$(".Validform_checktip").removeClass().addClass("Validform_checktip").empty(),$("#lblAddAddress").html("修改收货地址").show(),$("#newAddress,#addressedit").show(),$("html,body").animate({scrollTop:$("#lblAddAddress").offset().top},500)})}),$("#modAddress").on("click",".setDefault",function(){var t={address_id:$(this).closest("tr").attr("data-id")},e=$(this);$.get("/member/address.html",t,function(t){t=JSON.parse(t),200==t.state&&($("#modAddress .default").after('<a href="javascript:void(0)" class="setDefault">设为默认</a>').remove(),e.after('<span class="default">默认地址</span>'),e.remove())})})}},modOrder:{init:function(){return $("#modOrder")[0]?(this.bindEvent(),void this.fixBorder()):!1},fixBorder:function(){$(".myOdr_tb2").each(function(){$(this).find("tr:last").removeClass("hasborder")})},bindEvent:function(){$(".garbage").click(function(){ht.util.popAlert.run(function(){var t=ht.util.popAlert.confirm("您确定要删除该订单吗？","iDialogDelOrder");$.blockUI.defaults.css.textAlign="justify",$.blockUI({css:{width:"520px"},message:t}),$("#iDialogDelOrder .iDialogYes").click(function(){alert("删除"),$.unblockUI()})})}),$(".cancelOrder").click(function(){var t=$(this),e=t.closest("tr.border");ht.util.popAlert.run(function(){var t=$("#templateCancelOrder").tmpl({id:1});$.blockUI.defaults.css.textAlign="justify",$.blockUI({css:{width:"520px"},message:t}),$("#iDialogCancelOrder .result-wrap").click(function(){$("#iDialogCancelOrder .cp-arrow").hasClass("cp-arrow-down")?($("#iDialogCancelOrder .options").show(),$("#iDialogCancelOrder .cp-arrow").removeClass("cp-arrow-down").addClass("cp-arrow-up")):($("#iDialogCancelOrder .options").hide(),$("#iDialogCancelOrder .cp-arrow").removeClass("cp-arrow-up").addClass("cp-arrow-down"))}),$("#iDialogCancelOrder .option").click(function(){$("#iDialogCancelOrder .result").html($(this).html()).attr("value",$(this).attr("value")),$("#iDialogCancelOrder .options").hide(),$("#iDialogCancelOrder .cp-arrow").removeClass("cp-arrow-up").addClass("cp-arrow-down")}),$("#iDialogCancelOrder .cancelOrderBtnOk").click(function(){var t=e.attr("data-id"),a=e.find(".item:first").attr("data-itemid"),r={_xsrf:$("input[name=_xsrf]").val(),cancle_reason:$("#iDialogCancelOrder .result").html()};console&&console.log(r.cancle_reason),$.ajax({url:"/order/order_"+t+".html",data:r,type:"DELETE",success:function(t){t=JSON.parse(t),200==t.state&&(e.find(".orderStatusBtn").html("订单关闭"),e.find(".operate").html('<a class="againBuy" href="/item/detail/'+a+'.html">再次购买</a>'),$.unblockUI())}})})})}),$(".getWuliu").on("click",function(){var t=$(this).offset(),e=$(this).attr("data-id");$("#wuliuInfo").empty().show().css({left:t.left-80,top:t.top+20}),$("#templateWuliuLoading").tmpl([{id:1}]).appendTo("#wuliuInfo"),$.getJSON("/member/order/express_check/"+e+".html",function(e){if(200==e.state){e.number=1,e.data[0].className="first",e.data[e.data.length-1].className="last";var a=[{number:1,WaybillNumber:e.WaybillNumber,company:e.company_name,data:e.data}];$("#wuliuInfo").empty().show().css({left:t.left-80,top:t.top+20}),$("#templateWuliu").tmpl(a).appendTo("#wuliuInfo"),e.data.length>2&&$("#wuliuInfo .infoWrap:first").addClass("last")}else $("#wuliuInfo").empty().show().css({left:t.left-80,top:t.top+20}).addClass("wuliuError"),$("#templateWuliuError").tmpl([{id:1}]).appendTo("#wuliuInfo")})}),$(".confirmReceived").on("click",function(){var t=$(this),e=t.closest("tr.border");ht.util.popAlert.run(function(){var t=ht.util.popAlert.confirm("您收到包裹了吗？","iDialogRecOrder","确认收货");t=t.replace(/<span>确认<\/span>/g,"<span>已收到货</span>"),$.blockUI.defaults.css.textAlign="justify",$.blockUI({css:{width:"520px"},message:t}),$("#iDialogRecOrder .iDialogYes").click(function(){var t=e.attr("data-no"),a=e.attr("data-id"),r=e.find(".item:first").attr("data-itemid"),i={_xsrf:$("input[name=_xsrf]").val()};$.ajax({url:"/order/order_"+a+".html",data:i,type:"PUT",success:function(a){a=JSON.parse(a),200==a.state&&(e.find(".orderStatusBtn").html("订单关闭"),e.find(".operate").html('<a class="letmcmt comment btn-white30" href="#">评价</a><a class="againBuy" href="/item/detail/'+r+'.html">再次购买</a>'),$("#iDialogRecOrder").empty(),$("#templateRecOk").tmpl({order_no:t}).appendTo("#iDialogRecOrder"))}})})})}),$(document).click(function(t){var e=$(t.target);0==e.closest(".getWuliu").length&&0==e.closest("#wuliuInfo").length&&$("#wuliuInfo").hide()})}},modCollect:{init:function(){return $("#modCollect")[0]?void $("#result .delete").click(function(){var t=$(this);ht.util.popAlert.run(function(){var e=ht.util.popAlert.confirm("从我的收藏中删除？","iDialogDelFav");$.blockUI.defaults.css.textAlign="justify",$.blockUI({css:{width:"520px"},message:e});var a={_xsrf:$("input[name=_xsrf]").val(),item_id:t.attr("data-itemId")};$("#iDialogDelFav .iDialogYes").click(function(){$.ajax({url:"/member/collections.html",data:a,type:"DELETE",success:function(e){if(e=JSON.parse(e),200==e.state){t.parent().remove();var a=parseInt($("#collectionCount").text(),10)-1;$("#collectionCount").text(a)}}}),$.unblockUI()})})}):!1}}},$(function(){ht.member.init()})}(window);