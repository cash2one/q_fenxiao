;;ht.indexList={
	init:function(){
		this.getData(function(){
			ht.indexList.getMoreData();
		});
		this.stickySearch();
		this.moveCurrent();
		this.touchMoreMenu();
		this.seeMoreMenus();
	},
	moveCurrent:function(){
		if(!$('#navTop .curr')[0]){
			return;
		}
		var outerWidth=$('.js-navbox').width();
		var offsetLeft=$('#navTop .curr')[0].offsetLeft+$('#navTop .curr').outerWidth();
		var n=offsetLeft-outerWidth+84;
		if(offsetLeft-outerWidth>40){
			n=-n;
			$('.js-navbox').css({'transform':'translate('+n+'px, 0px) translateZ(0px)'});
		}else{
			$('.js-navbox').css({'transform':'translate(0px, 0px) translateZ(0px)'});
		}
	},
	seeMoreMenus:function(){

		var $dropdown=$('#m-dropdown');
		$('#navTop .select-btn').click(function(){
			$dropdown.addClass('show mask');
			var html=$('#navTop .navbox').html();
			var html2=html.replace(/span/g,'li').replace(/width:20%/g,'');
			$dropdown.find('.floors').html(html2);

		});

		$('#m-dropdown .select-btn').click(function(){
			$dropdown.removeClass('show mask');
		});

		$('#m-dropdown').click(function(e){
			var target  = $(e.target);
			if(target.closest(".floors").length == 0 && target.closest(".tit").length == 0){
				$(this).removeClass('show mask');
			}
		});

	},
	touchMoreMenu:function(){
		var isdrag=false;
		var startX,endX,cur;
		var cur,direction=0;
		var $dom=$('.js-navbox');
		var outerWidth=$('.js-navbox').width();
		var innerWidth=0;
		$('.js-navbox span').each(function(){
			innerWidth=innerWidth+$(this).outerWidth()
		});
		var offWidth=outerWidth-innerWidth-80;

		$dom[0].addEventListener('touchstart',touchStart);
		$dom[0].addEventListener('touchmove',touchMove);
		$dom[0].addEventListener('touchend',function(){
			isdrag = false;
		});
		function touchStart(e){
			isdrag = true;
			//e.preventDefault();
			startX = e.touches[0].pageX;
			var reg=/\-?[0-9]+/g;
			cur=parseInt($dom[0].style.webkitTransform.match(reg)[0],10);
		}
		function touchMove(e){
			if (isdrag){
				e.preventDefault();
				endX=e.touches[0].pageX;
				var n =  endX - startX;
				direction=n>0?'right':'left';
				n=cur + n;
				if(direction=='right' && n>0){
					n=0;
				}

				if(direction=='left' && n<offWidth){
					if(offWidth>80){
						offWidth=0;
					}
					n=offWidth;
				}
				$dom.css({'transform':'translate('+n+'px, 0px) translateZ(0px)'});

			}
		}
	},
	getMoreData:function(){
		var $waterLoading=$('#waterLoading');
		ht.core.waterFall(200,$waterLoading,function(){
			ht.indexList.getData(function(){
				ht.core.lazyLoad();
				$waterLoading.hide();
			});
		});
	},
	stickySearch:function(){
		var $hearder=$('#navTop');
		var top=$hearder.offset().top;
		$(window).on("scroll", function () {
			var s=$(window).scrollTop();
			s > top ? $hearder.addClass('topTabBoxFixed') : $hearder.removeClass('topTabBoxFixed');
		});
	},
	page:1,
	getData:function(callback){
		if($('#waterAllShow').is(':visible')){
			$('#waterLoading').hide();
			return;
		}
		var param={
			page:ht.indexList.page
		}
		$.getJSON('/selected_items.html',param,function(r){
			ht.core.lazyLoad();
			if(r.data.length==0){
				$('#waterLoading').hide();
				$('#waterAllShow').show();
				return;
			}
			$('#templateList').tmpl(r.data).appendTo('#dataList');
			ht.core.lazyLoad();
			ht.indexList.page++;
			callback && callback();
		});
	}


}
$(function(){
	ht.indexList.init();
});